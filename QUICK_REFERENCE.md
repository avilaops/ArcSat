# üöÄ ArcSat Azure - Quick Reference

## Comandos Essenciais

### Deploy R√°pido
```bash
# Deploy automatizado completo
./deploy-azure.sh

# Deploy manual via Bicep
az deployment group create \
  --resource-group ArcSat-RG \
  --template-file azure-deploy.bicep \
  --parameters azure-deploy.parameters.json
```

### Verifica√ß√£o de Status
```bash
# Health check da API
curl https://arcsat-api.azurewebsites.net/health

# Logs em tempo real
az webapp log tail --name arcsat-api --resource-group ArcSat-RG

# Status dos servi√ßos
az webapp show --name arcsat-api --resource-group ArcSat-RG --query "state"
```

### Gerenciamento de Vari√°veis
```bash
# Listar todas as configura√ß√µes
az webapp config appsettings list --name arcsat-api --resource-group ArcSat-RG

# Adicionar/atualizar configura√ß√£o
az webapp config appsettings set \
  --name arcsat-api \
  --resource-group ArcSat-RG \
  --settings KEY=VALUE

# Usar Key Vault
az webapp config appsettings set \
  --name arcsat-api \
  --resource-group ArcSat-RG \
  --settings SECRET="@Microsoft.KeyVault(SecretUri=https://arcsat-kv.vault.azure.net/secrets/secret-name)"
```

### Key Vault
```bash
# Criar secret
az keyvault secret set --vault-name arcsat-kv --name secret-name --value "secret-value"

# Ler secret
az keyvault secret show --vault-name arcsat-kv --name secret-name

# Dar permiss√£o ao App Service
az keyvault set-policy \
  --name arcsat-kv \
  --object-id <managed-identity-principal-id> \
  --secret-permissions get list
```

### Monitoramento
```bash
# Ver m√©tricas de CPU
az monitor metrics list \
  --resource /subscriptions/{sub-id}/resourceGroups/ArcSat-RG/providers/Microsoft.Web/sites/arcsat-api \
  --metric "CpuPercentage"

# Query Application Insights
az monitor app-insights query \
  --app arcsat-insights \
  --analytics-query "requests | where timestamp > ago(1h) | summarize count() by resultCode"
```

### Troubleshooting
```bash
# Download de logs
az webapp log download --name arcsat-api --resource-group ArcSat-RG

# SSH no container
az webapp ssh --name arcsat-api --resource-group ArcSat-RG

# Reiniciar aplica√ß√£o
az webapp restart --name arcsat-api --resource-group ArcSat-RG
```

### Docker (Local)
```bash
# Build da imagem
docker build -t arcsat-api .

# Executar localmente
docker run -p 5500:8080 --env-file .env arcsat-api

# Usar docker-compose
docker-compose up -d

# Ver logs
docker-compose logs -f api
```

## üìÅ Arquivos Importantes

| Arquivo | Descri√ß√£o |
|---------|-----------|
| `web.config` | Configura√ß√£o IIS para Azure App Service |
| `startup.sh` | Script de inicializa√ß√£o do container |
| `azure-deploy.bicep` | Template Infrastructure as Code |
| `Dockerfile` | Imagem Docker da aplica√ß√£o |
| `staticwebapp.config.json` | Config do Static Web App (frontend) |
| `AZURE_DEPLOYMENT.md` | Guia completo de deployment |
| `TROUBLESHOOTING.md` | Guia de troubleshooting |

## üîó URLs de Produ√ß√£o

- **API**: https://arcsat-api.azurewebsites.net
- **Frontend**: https://arcsat-frontend.azurewebsites.net
- **Health Check**: https://arcsat-api.azurewebsites.net/health
- **Readiness**: https://arcsat-api.azurewebsites.net/api/health/ready
- **Kudu**: https://arcsat-api.scm.azurewebsites.net

## üîê Vari√°veis de Ambiente Obrigat√≥rias

### Desenvolvimento
- `MONGO_URI`
- `JWT_SECRET`
- `PORT`
- `NODE_ENV`

### Produ√ß√£o (adicional)
- `APPLICATIONINSIGHTS_CONNECTION_STRING`
- `API_URL`
- `FRONTEND_URL`
- `CORS_ORIGINS` (JSON array)

## üìä Queries √öteis (Application Insights)

```kusto
// Requisi√ß√µes com erro
requests
| where success == false
| order by timestamp desc

// Performance por endpoint
requests
| summarize avg(duration), percentile(duration, 95) by name

// Exce√ß√µes recentes
exceptions
| where timestamp > ago(1h)
| order by timestamp desc
```

## ‚ö° Performance Tips

1. **Habilitar Always On**: `az webapp config set --always-on true`
2. **Usar cache de CDN** para static assets
3. **Implementar Connection Pooling** no MongoDB
4. **Configurar Application Insights Sampling**
5. **Usar Redis** para sess√µes (se necess√°rio)

## üéØ Checklist de Deployment

- [ ] Configurar secrets no Key Vault
- [ ] Whitelist IPs no MongoDB Atlas
- [ ] Configurar dom√≠nios personalizados
- [ ] Configurar SSL/TLS
- [ ] Habilitar Application Insights
- [ ] Configurar alertas
- [ ] Testar health checks
- [ ] Configurar backup (se aplic√°vel)
- [ ] Documentar URLs de produ√ß√£o
- [ ] Configurar GitHub Actions secrets

## üìû Suporte

- **Email**: nicolas@avila.inc
- **Docs**: https://docs.arcsat.com.br
- **Azure Portal**: https://portal.azure.com
