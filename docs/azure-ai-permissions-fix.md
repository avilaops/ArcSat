# Azure AI Foundry - Corre√ß√£o de Permiss√µes
# Instru√ß√µes para resolver os erros de permiss√£o

## Problemas Identificados

### 1. ‚ùå No deployed models
- **Erro:** "There are no deployed models in this project"
- **Causa:** Nenhum modelo foi deployado no projeto Azure AI Foundry
- **Solu√ß√£o:** Deploy dos modelos necess√°rios

### 2. ‚ùå Vector Stores Permission
- **Erro:** Principal '231c21a1-f133-4024-9a7c-7bf8d4350fae' lacks required data action 'Microsoft.CognitiveServices/accounts/AIServices/assets/read'
- **Causa:** Falta permiss√£o para ler Vector Stores
- **Solu√ß√£o:** Atribuir role "Cognitive Services User" ou superior

### 3. ‚ùå Agents Permission  
- **Erro:** Failed to load agents for project arcsat: 401
- **Causa:** Falta permiss√£o para carregar agentes
- **Solu√ß√£o:** Atribuir role "Cognitive Services Contributor"

## üîß Solu√ß√µes

### Passo 1: Fazer Login Interativo no Azure
```bash
az logout
az login
az account set --subscription "3b49f371-dd88-46c7-ba30-aeb54bd5c2f6"
```

### Passo 2: Configurar Permiss√µes RBAC
```bash
# Cognitive Services User (para leitura)
az role assignment create \
  --role "Cognitive Services User" \
  --assignee "231c21a1-f133-4024-9a7c-7bf8d4350fae" \
  --scope "/subscriptions/3b49f371-dd88-46c7-ba30-aeb54bd5c2f6/resourceGroups/Avila/providers/Microsoft.CognitiveServices/accounts/arcsat-resource"

# Cognitive Services Contributor (para escrita)
az role assignment create \
  --role "Cognitive Services Contributor" \
  --assignee "231c21a1-f133-4024-9a7c-7bf8d4350fae" \
  --scope "/subscriptions/3b49f371-dd88-46c7-ba30-aeb54bd5c2f6/resourceGroups/Avila/providers/Microsoft.CognitiveServices/accounts/arcsat-resource"

# AI Developer (para projetos AI Foundry)
az role assignment create \
  --role "AI Developer" \
  --assignee "231c21a1-f133-4024-9a7c-7bf8d4350fae" \
  --scope "/subscriptions/3b49f371-dd88-46c7-ba30-aeb54bd5c2f6/resourceGroups/Avila/providers/Microsoft.CognitiveServices/accounts/arcsat-resource"
```

### Passo 3: Deploy de Modelos Essenciais
```bash
# GPT-4o-mini para chat
az cognitiveservices account deployment create \
  --resource-group "Avila" \
  --name "arcsat-resource" \
  --deployment-name "gpt-4o-mini-chat" \
  --model-name "gpt-4o-mini" \
  --model-version "2024-07-18" \
  --model-format "OpenAI" \
  --sku-capacity 10 \
  --sku-name "Standard"

# Text Embeddings para Vector Search
az cognitiveservices account deployment create \
  --resource-group "Avila" \
  --name "arcsat-resource" \
  --deployment-name "text-embedding-ada-002" \
  --model-name "text-embedding-ada-002" \
  --model-version "2" \
  --model-format "OpenAI" \
  --sku-capacity 5 \
  --sku-name "Standard"

# GPT-4 para an√°lises complexas
az cognitiveservices account deployment create \
  --resource-group "Avila" \
  --name "arcsat-resource" \
  --deployment-name "gpt-4-analysis" \
  --model-name "gpt-4" \
  --model-version "turbo-2024-04-09" \
  --model-format "OpenAI" \
  --sku-capacity 3 \
  --sku-name "Standard"
```

### Passo 4: Verificar Configura√ß√£o
```bash
# Listar deployments
az cognitiveservices account deployment list \
  --resource-group "Avila" \
  --name "arcsat-resource"

# Verificar permiss√µes
az role assignment list \
  --scope "/subscriptions/3b49f371-dd88-46c7-ba30-aeb54bd5c2f6/resourceGroups/Avila/providers/Microsoft.CognitiveServices/accounts/arcsat-resource"

# Testar conex√£o
az cognitiveservices account show \
  --resource-group "Avila" \
  --name "arcsat-resource"
```

## üéØ Roles Necess√°rias

### Cognitive Services User
- **Descri√ß√£o:** Permite ler e chamar APIs dos Cognitive Services
- **A√ß√µes:** `Microsoft.CognitiveServices/*/read`, `Microsoft.CognitiveServices/accounts/*/read`
- **Necess√°ria para:** Vector Stores, leitura de modelos

### Cognitive Services Contributor  
- **Descri√ß√£o:** Gerenciamento completo de recursos Cognitive Services
- **A√ß√µes:** `Microsoft.CognitiveServices/*`
- **Necess√°ria para:** Agents, cria√ß√£o/modifica√ß√£o de recursos

### AI Developer
- **Descri√ß√£o:** Role espec√≠fica para Azure AI Foundry
- **A√ß√µes:** Acesso completo a projetos AI, modelos e agentes
- **Necess√°ria para:** Projetos AI Foundry, deployment de modelos

## üîç Verifica√ß√£o de Status

Ap√≥s executar os comandos, verifique:

1. ‚úÖ Modelos deployados aparecem na UI
2. ‚úÖ Vector Stores carregam sem erro
3. ‚úÖ Agents s√£o listados corretamente
4. ‚úÖ Permiss√µes RBAC est√£o ativas

## üìû Suporte

Se ainda houver problemas:
1. Verificar se o principal existe no Azure AD
2. Confirmar que tem Owner/Contributor na subscription
3. Aguardar 5-10 minutos para propaga√ß√£o de permiss√µes
4. Fazer refresh na UI do Azure AI Foundry